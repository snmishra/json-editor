version: '3'
services:
  node:
    build:
      context: ..
      dockerfile: tests/Dockerfile
    volumes:
      - ..:/repo:delegated
      - /repo/node_modules
    working_dir: /repo/tests/codeceptjs
    environment:
      - PUPPETEER_SKIP_DOWNLOAD=1
    command: env PATH="/repo/node_modules/.bin:$PATH" npm run serve-test
    ports:
      - '9100:9100'
    expose:
      - '9100'
    user: node
  firefox:
    image: selenium/standalone-firefox:latest
    depends_on:
      - node
    environment:
      - VNC_NO_PASSWORD=1
    ports:
      - '4444'
      - '9059:5900'
    # Mount shm also for firefox, see https://github.com/SeleniumHQ/docker-selenium#running-the-images
    shm_size: '2gb' # for windows environment
  chrome:
    image: selenium/standalone-chrome:latest
    depends_on:
      - node
    environment:
      - VNC_NO_PASSWORD=1
    ports:
      - '4444'
      - '9060:5900'
    # Mount shm also for firefox, see https://github.com/SeleniumHQ/docker-selenium#running-the-images
    shm_size: '2gb' # for windows environment
